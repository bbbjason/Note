好那接下來上這個
那大家如果
隨時有問題的話可以隨時就是
舉手跟我講一下這樣
那這是我們整體的outline
今天不會全部講完
因為最後面這個設置
是下一堂課會講
就是下禮拜會講
今天會講兩堂課
就是powerline跟化塵這樣子
那今天會教大家
從fairytalk是什麼東西啊
然後什麼時候要用到它
為什麼要用到它
然後到fairytalk要怎麼寫
它是一個程式語言
所以大家就是要在這堂課裡面
學說這個程式語言要怎麼寫
然後最後就是一個e-sensor
讓大家看看說長什麼樣子
就是實際寫下來長什麼樣子這樣
那麼好
那我們後面的作業呢
都會都會是跟fairytalk
大幅度相關的
所以作業二作業三
然後到project的小作業
都是fairytalk這樣
好的
那首先是introduction的部分呢
fairytalk到底是什麼呢
它其實就是一種
這個Hardware Description Language
我們說它是HDL啊
縮寫
那主要呢
就是在做這個數位電路設計的
它就是一種程式語言
叫做fairytalk這樣
那fairytalk到底有什麼目的呢
是說大家作業一應該都畫過那個layout
那你畫那個layout的時候啊
我們有給你基本元件
所以你可以稍微用基本元件去組合
可是你用基本元件去組合
你要畫一些什麼gate啊
就已經有夠辛苦了
然後如果你想要做一個function的話
它就很複雜
所以像你手機那種芯片啊
它上面的一些程式啊
它如果是刻在芯片裡面的這個程式的話
那它其實是需要非常非常多的這個全新程式去
就是去把它實現出來這樣
那你如果要自己用手刻呢
實在是並不是很實際
對
所以我們就會用這種電子設計自動化的
edit tool的幫助下
寫fairytalk
那藉由edit tool把它變成layout這樣
你不用自己在那邊手刻這樣
好
那這裡面verilog的
verilog的層級有跟這些有相關
就是說
最上面的behavior level
就是說你寫一個
你說我要有一個function
它有什麼功能
相片進去
它要變漂亮
那個對比度調高之類的
那要怎麼實現呢
你可能就要寫這個RTL level
RTL level就是
我們用verilog去寫這樣
然後呢
RTL level呢
它其實就會長得有點像右邊這樣子
這邊有四個層級嘛
畫一下
誒
誒
不能用手畫
稍等我一下
對
不行誒
我畫不上去
好吧
反正就是這邊有四個層級嘛
那上面就是一個function
那第二個呢
就是
我是說它還沒教到flipflop啦
不過第二個那個啊
左右就是各式一個flipflop
那中間是一個combinational的計算
這我們後面都會稍微講到
或是老師上課的時候
都會再講仔細一點這樣
反正呢
這邊我們要知道就是說
誒RTL level
也就是verilog
寫的是右邊圖的第二個那個
模式啊
那
經過這個
我們剛剛說的一疊tool之後呢
可以把它轉變成下面那兩種
下面那兩種
這下面那個
我們就可以看到那個transistor level
就是
我們平常在畫layout
它就一層一層metal啊
body啊那些都幫你畫上去這樣
然後gate level就是
它就把它轉換成各種基本的gate這樣子
那
所以呢
你就只要寫這個
紅色的這個RTL level
然後它就可以自動幫你轉換成
下面這兩個這樣
好的
那
這邊的話呢
是稍微一個
就是簡單的示範
就是說
RTL level呢
你寫的是上面這個
就有一個info啊
有一個else啊
然後有一些
比較例行的東西
那寫出來就會是右邊這個一個mass
這是寫起來大概就是長這個樣子
那
你把它經過
我們剛剛做一些tool轉換之後呢
它就可以轉成gate level
gate level的code還是可以看得懂的
所以就把它印出來給大家看
就是
一個mass
它就是要變成一些and not
and or gate
然後去把它弄起來
收成右邊那個樣子
這就是一個mass
mass tool這樣子
所以
對這就是一個轉換的一個
舉例啦
好
那我們這堂課呢
這個
基本上這是整個
整個我們說self-based的design
self-based其實就是
就是有一些基本的元件
它已經先幫你做成一些cell
一些基本的cell
那你就可以call這些standard cell
去把它組合成
你的這個layout這樣
這些都是
這些這些背景知識
都是其實PDFool都幫你處理好
你只要看說
spec
spec是specification
它是這個就是
呃
比如說廠商要給你的條件
跟你說我要怎麼樣
怎麼樣的軍件這樣
那你就寫atl
coding之後呢
就產生atl code
atl code之後呢
你就把它拿去這個合成
呃我看看我有沒有辦法用
指標雷射筆
把它
你就可以把atl code拿去合成
那合成之後呢
就會得到gate level的code
那這個合成就是我們剛剛說
你要用EDA tool這樣
然後呢
會有這個DFD insertion
ATPG
這是比較驗證的東西
我們這個這門課不會講到這麼細
所以這兩個是
大家不會遇到的
所以呢合成之後
gate level
我們就把它直接拿來
TAR
就是place and route
那
這邊呢
就會產生這個GDS的file
那這邊呢
大家可能還會再去
拿去做一些DRC LVS
這些大家都做過
LPE
這個我們也不會講到
那最後呢
就會
你就可以去台積電下載影片
那我們不會做到這個地方
基本上呢
我們這門課啊
就是作業就是給你這個
spec
那
你就把它
做atl coding之後呢
這是你atl code
然後合成
得到gate level的code
再把它
APR
就是layout
那產生一個layout的code
這邊還會再產生一個layout的code
有點像GDS layout這邊
那這邊會有三階段要做驗證
黃色的這個
所以這門課主要是
聚集在這個部分
這樣
除了DFD insertion以外這樣
就是會做這些步驟
這是一個完整的flow
就是如果大家去什麼
以後去科技業面試
可以講一下這種
這樣子
好的
那
我大概
今年是2021
我這2012休是門課的
那時候老師在上課的時候就會說
他就會說
他有一些投影片會說
這個東西很重要
就表示
考試可能會考這樣
那
所以呢
我是在右上角打一個星星
不過考試考不考
其實我也不知道
就是老師不知道會不會考
但是
我現在這邊打的紅色的星星是
我認為
跟考試無關
就是我認為大家寫作業比較容易
需要
需要注意的地方
這樣子
所以後面會有一些投影片
有打這個星星
就是比較重點的地方
那
如果是跟理論
或者是跟考試比較有關的
我會另外用
我記得是綠色的星星吧
就是
等一下看到了再跟大家講
反正就是紅色的星星
是我覺得
大家初學者在寫RTL code的時候
要比較注意的一些
投影片
這樣
好
那
總結來說呢
Verilog就是這個數位IC設計
數位IC在
就是你要寫的這個程式語言
這樣子
然後
它有三個level
就是RTL level
Gate level跟Transistor
那
再來我要講的一些東西
一些事情呢
沒有特別寫在投影片上面
但是很重要
希望大家特別記起來
就是說
Verilog
跟一般的
這個C語言
或者是一些軟體的語言
這個Python啊之類的
Perl啊之類的
最大的差別呢
是
它有
所謂的時間觀念
然後
它不會逐行執行
基本上你
你如果C語言可能還會compile
但是如果像Python那種東西的話
他們就是會逐行執行
所以你寫在上面
就是會先執行
寫在下面就會後執行
Verilog不會
它會整份code
全部一起執行
所以呢
所以呢
這個它不會逐行執行
這件事情是還蠻重要的
為什麼會全部一起執行呢
你要想說
你沒寫一行code
它就是會對應到一塊電路
有點像你寫了一個NAND gate
它就會畫出一個NAND gate出來
那每個NAND gate
在導通電了之後
全部通通會一起動
因為它就是通電了嘛
對不對
所以前面有input什麼訊號
它就會操作一下
然後得到output訊號
所以呢
會全部一起動
那全部一起動的情況下呢
我們會用一些就是
我們會用一些Flip Flop
就是這個東西
這個東西是Flip Flop
那
會用這個東西來控制
控制每一塊
我們剛剛說每一塊每一塊的電路
控制這些電路
在每一個時間點
應該要做什麼事情
所以呢
下面這邊其實是
一個example
就是說
我們剛剛說它有時間觀念
是怎麼樣呢
就是說
你的電路通常就一定會有一個clock
數位電路都會有一個clock
那這個clock呢
其實很重要
就是說
一個clock呢
就是一個上去一個下來這樣
叫做cycle
那一個cycle裡面呢
它會做什麼事情
你要知道
就是說
我現在寫出來的電路
有這兩個訊號
那這兩個是外界寫進來的電路
外界輸入進來的input是一個容量
那
input是各種進來之後呢
我要知道說
欸
在第一個clock cycle
我的電路會怎麼運作
在第二個clock cycle
我的電路會怎麼運作
每一個訊號
它在每一個clock cycle
它會變成什麼樣的
理論上你都可以用
邏輯的方式去推導
因為是你自己寫的電路嘛
應該要知道說
每一個variable
它怎麼變化這樣
那
這個clock cycle呢
它就是由我們右邊畫的那個
Flip Flop所控制的
所以Flip Flop就是
它會吃一個clock的訊號
然後
你可以不要看圈圈的部分
它這邊有一個
這個是input
然後這個是output
這個是吃clock的地方
這就是clock
所以這個clock呢
後面虛線接到下一個Flip Flop
它也是接到這裡
那
所以呢
它的意思就是說
我這個input啊
它
我們會說這個Flip Flop
是一個導
導下來的動作
導一個clock cycle的動作
什麼意思呢
就是說
我有一個input data
例如說我input是
這個input的地方啊
輸入是2
那2的話呢
呃
假設假設我們clock
以正圓這邊
這邊當作基準
那也就是說呢
在這個passage的地方呢
這樣錄影的可能會看不到
譬如說
在這個passage的地方呢
它這個
這個Flip Flop的
output的值才會改變
所以在passage的地方
它才會改變成2
所以在
在這一段時間啊
在前面這一段時間
就是在這個正圓
以前這一段時間
到上一個正圓之間為止
這段時間呢
你的input就算
偷偷改成2
它也不會跳動
它一定要到
這個正圓的地方
passage的地方
它的
跳動的時候
它才會
output才會變成2
所以你才會看到說
這個數字它
跳動的很規律
不會說input
一直改變
它就會一直跳
基本上就是
就是它只有在clock
跳動的那一瞬間
它才會把前面的input值
輸出到後面的output
才把它顯示出來這樣
好
總之呢
就是Flip Flop它會改入
一個clock cycle
這種感覺
那
這時呢
我們要強調的重點就是
你在寫這個電路的時候
要盡量的
搞清楚
每一個時間點
每一個時間點
你的電路應該要做什麼事情
每一個變數
應該要做什麼事情
都大概要知道
這樣
好
那這件事情呢
是我們寫verilog
在debug的時候
最重要的依據
因為debug的時候
印出來就會印這個東西
那你就要看說
到底為什麼我的結果會錯
我哪裡算錯了
那這個算出這個東西
前面是算什麼
前面是算什麼
哪一個步驟算錯
你要倒推回去
才可以知道說
code哪裡有問題
這樣
所以這是一個
其實這個就是我們
debug的tool的介面
只是把它解錄出來而已
後面還會再show這個東西給大家看
對
但是這是
這是一個summary的頁面
所以我就把它
就是盡量的
完整的給大家go through過一次
這樣
好
這頁大概就這個樣子
好的
那再來呢
就比較無聊一點的
是一些verilog的這個語法的介紹
大家也知道
寫程式這東西
基本上
講語法很無聊
然後講了
沒有自己寫過
沒有去熟悉
其實也很難
也很難有什麼感覺
所以呢
總之我還是會大概講一下
對
大家就是輕鬆聽就好
當我覺得特別重要的時候
再跟大家講
這邊有打一個星星
就特別重要的地方
其實這是一個
算是一個很小
但是完整的範例
那就是
全部影片看完之後
你就可以
以這個為一個參考
這樣
就把它打一個星星
就是大家
可以用它當作一個summary
這樣
那可能要稍微注意一下
這個左邊有行號
它其實是左上角這個
然後再來才右邊這個
然後最後是下面這個
就是它的順序是
這三個是1
這個是2
這個是3
這樣子
因為台版的關係
然後呢
其實就是要看
它分成五個大的區塊
然後
verilog裡面
verilog裡面
比較特別
特別的嚴謹使用它的
規定的coding style
包含一些
這個對齊
最好也要把它對齊一點
然後
它的coding style
你可以看到我們code寫起來
就會是一個很對稱的形式
這樣
那
它的coding style
長什麼樣子
我們後面都會
去詳細的介紹
但是大家就是後面
在介紹的時候
可以翻回來這邊
去對照一下
這樣子
這上面呢
這邊是一個module的宣告
然後
macro
macro就是有點像
這個
你在C裡面
可能會宣告一些parameter
就是一些
變數
就是
只是幫它取名字
幫變數取名字
這樣比較好
操控
比較可讀性比較高
然後
register跟wire的宣告
這兩個就是verilog的data type
你幾乎只會用到這兩個
register跟wire
最多最多可能還會再用一個integer
這我們等下都會介紹
就是變數宣告
然後呢
有combinational part
跟sequential part
這個東西
老實說
交電的時候
好像大家有交過
一點點
不過因為交電離我
實在是有點遙遠
我其實也不記得交電上過什麼
老實說
這門課
好像還沒有
太介紹到sequential跟combinational
反正
大家可以先稍微看一下
有這兩個part
那主要呢
可以給大家一個簡單的concept
就是sequential part
就是我們剛剛前面講到
那些flip-flop的宣告
的控制
所以跟flip-flop有關的
都會放在這裡
然後combinational part
就是跟計算有關的
我們剛剛那一張
前面那個
在講解flip-flop的時候
有一張圖
flip-flop是長方形的
有一個三角形在裡面
那是flip-flop
那中間呢
有一個橢圓形
那個橢圓形就是combinational part
所以橢圓形就是在做計算
flip-flop就有點像是
在把
把數值擋下來
在用不同class cycle
用數值把他擋下來
這樣子
好的
那我現在看
好
那這一頁就大概這樣子
好
那再來就是一些
那個
語法
語法我就要坐著講
因為其實有點無聊
好
好
這個是我們剛剛最前面講的
就是你module的宣告
module嘛
那就是你要宣告module
然後最後面要end module
好
這個verilog語法
常常都是有一個begin
跟一個end這樣
好
這個module
end module
然後module的名稱
好
然後你這個module
有什麼input output
你要把它寫在這裡
那寫完之後呢
括號起來
分號
然後說哪一些是input
要把它再重複一遍
所以這些abc啊
其實posedisk裡面都有
abc
好
只是說
這個時候呢
你就要再說
我這個a是幾個bit
b是幾個bit
c是幾個bit
然後abc分別是input
還有output
這樣子
然後下面才是你code的本體
所以剛剛講的
什麼五六個posed
全部
五個posed
全部都要寫在這個裡面
然後最後才end module
所以
有點像這樣
可是中間少了很多東西
就是了
反正大家可以回去看
上一個example這樣
好
那
這個register
欸不是
這邊是在講這個
數值
數值的話呢
格式是這樣
就是說
我們平常在寫c
或者是這個python的時候呢
數字啊
你就直接寫數字就好
可是在這裡面啊
你的數字呢
就要指定一些事情
一
是你的
這個數字有幾個bit
二
是你的
這個
進位字
要二進位
三進位
四進位
沒有三進位
四進位
八進位
十六進位
十進位之類的
然後再來才是你的value
所以寫起來就會像這邊這樣子
四個bit
逗號
不是逗號
那不知道算什麼
反正就上面一撇
然後d是decimal
就是十進位
然後9
四個bit就是0到15嘛
所以
9就還ok
就是在這個
在這個範圍裡面
那就是十個bit
然後binary
binary就二進位
然後01
前面一堆0其實可以省略啊
你也可以把它寫成這個樣子
就是
十鐵b
然後000000001
寫這樣也可以
然後這個是h
h就是hesitissimo
那就是十六進位
所以呢
這個就是八個bit
然後十六
這個數字
所以出來其實跟八個bit
binary的0001
0000一樣
這個這個數字呢
你在寫的時候
這個底線是可以隨便你加的
就是幫助閱讀
不影響這個
不影響這個程式的讀取這樣子
那麼
我記得如果
前面不要寫的話
default會是十進位啊
不過呢
我們說verilog是一個非常嚴謹的程式語言
所以呢
你最好可以把這些東西寫清楚
這樣子他才不會容易出錯
這樣
那
這邊有寫default是十進位
然後
一些不好的example
四個bit就沒有到
十八嘛
所以這就超過了
這樣寫就會出問題
至於會變什麼樣子
我也不知道
可能你如果有興趣可以試試看
三個bit就
也沒有到
三個bit
三個bit有到六嗎
喔不是啦
三個bit有到六
但是這是binary
你不能用binary的格式寫六
這樣子也是會有問題的
你這邊寫b的話
你就是要用這種binary的方式去寫
6hab
這個我記得也是超過
對啊超過
超過這個六個bit的大小
這是h是十六進位
可以去導
推導一下這個
反正我記得是超過六個bit
然後verilog有這個
bitwise assignment這個東西
這個東西就是
有時候
你想要讓你的電路
更精進一點的時候
就是你最後
你的這個電路已經通過了作業
但是你想要讓他的performance更好
有時候final project我們可能會比
喔不一定喔
homework 3可能就會比
比較面積啊速度啊什麼的
那這個東西就可以調整一些細節
讓你的電路可以
更省
面積更小
速度更快之類的
那example的話有點像這個樣子
就是
這個就是說
a他可能有
7到4
這些bit
a可能有八個bit
那是7到0
那我就選前面四個bit
7到4
然後把他用b的3到0
也是四個bit
assign給他
所以呢右邊的example
你就可以看到說
上面這邊有寫a跟b
原本是
十進位的12跟
十六進位的34這樣
其實數值就是右邊這樣子
你就會把b後面這四個bit
放到a的前面這四個bit裡面
他就會轉過去
這樣子
大概像這樣
回去可以再感受一下
這樣
好那這邊有一些
基本的operation
這大家就可以自己看
什麼加減乘除啊
百分比啊
百分比就是餘數嘛
然後bitwise啊
這個negation啊
就是相反
and or
這個head是什麼我也忘記了
head好像是跟那個什麼
XOR之類的
有相關的
反正大家可以再去查一下
後面有舉例啦
這個head
這個head是什麼
應該是XOR吧
好
這邊
反正就是有一些operation
通例在這邊
那基本上跟一般的程式語言
沒有差很多
不等於啊
等於等於啊
這個邏輯的判斷
然後還有大於小於
這些的
shift比較特別啊
就是
他就是shift幾個bit
這樣子
你就可以想像說
他譬如說有三個bit
然後就往前移
就變成4到1
從3到0移到4到1
或往後移
這樣子
可以看右邊這個例子
你把
你把右邊這個
這個值呢
0111
往左移一個bit
就會變成111
然後補0
這樣子
然後concatenation呢
就是把他接起來
就是
B跟C
如果要接在一起
0110
然後用這個concatenation起來
就變0110
這樣子
這就是一些
下面這兩個是比較特別
軟體比較少用到這種東西啊
硬體才會有這種狀況
你往左shift一個bit
其實是乘以2嘛
那你就可以省掉一個乘法器
只用這個shift
就會
面積就會小很多
這種感覺
好的
那再來是Data Type的部分
Data Type呢
基本上我們最多最多的
就只
主要就會用到
Wire跟Register
那
初學者呢
幾乎可以不用Wire啦
對
這個投影片上面沒有寫
因為其實有一點
旁門左道
但是
初學者幾乎可以不用Wire
我們等下會講到
唯一要用到Wire的情況
那
其實你全部寫Register呢
錯誤訊息
就會告訴你
哪一些要改Wire
然後再把他改掉
其實也可以
那因為
大部分的情況呢
該寫Wire
可是寫Register的時候呢
Compiler都會自動幫你合成
對
所以其實是沒關係
對
他
他沒辦法幫你合成的地方
只有一個case
然後那個case
我們等下會講
他也會跳error message
應該夠明顯
好
那
這是Wire的宣告
或是Register的宣告
就是說
你的
你一個
一個變數嘛
那他是Wire
然後他有幾個bit
然後你要宣告
幾個這個變數
就一個
一個可能通常是八個bit嘛
然後這個變數可能有
三個
array size是3
vector的長度是8
所以呢
就是八個bit
然後array的size是3
那寫起來呢
就要注意
前面是寫7到0
後面是寫0到2
有一點
奇怪的寫法
對
不過就是
就是都是這樣寫
那下面有一sample
大家也可以看看
就
如果你只有
一個的話
後面就不用寫
啊如果有
128個
後面就要寫
這樣
bit數也是一樣
如果他只是一個bit的話
前面這邊也可以不用寫
好
那
這一頁呢
我打一個星星
其實是右下角這個表格
是重要的
那剩下的其實還好
就是說
剩下的其實都被
整理到這個表格裡面了
後面呢
我們還會再講一些
每個東西
都會一起把他merge進來
算是這個
Verilog在code的時候
他的一個規定
好
那就是
外額呢
input output port
他default都是用外額
這樣子
然後你要改他的值呢
只可以用assign去改
assign就是有一個寫法
叫做assign
c等於a and b
a加b之類的
或者a a乘以b之類的
這種東西
然後
register呢
他只能在
always block裡面改
那這個什麼assign
什麼always block
這個我們後面都會教
對
那always block呢
在下面這邊
就是他是一個always
at什麼東西
然後begin end
然後裡面有這些東西
所以呢
你的d跟你的c
就一定
要是d就要register
c就要wire
所以你就可以看到
他這邊c是宣告wire
d是宣告register
右邊倒是不一定啦
因為他說only be changed
所以就是你只能用
這個東西去改
但是右邊的
right hand side這邊的
就沒關係這樣
好的
那所以呢
我們就可以看到
右邊這個表格啊
這個
等號的左邊
這個也是一種
verilog的等號啦
這個是箭頭
這我們後面也都會講到
反正大家後面講一講之後
可以再來看這個表
等號的左邊呢
幾乎都是register
只有這個是wire
是什麼呢
上面這兩個都是用always block
那我們等下會講說
有sequential電路
跟combinational電路
那sequential呢
就是只有一種always block
那裡面有clock
combinational呢
就是有這兩種
這等下都會再更細講
這就是一個
最後大家可以
就幫大家整理起來
最後最後可以看這個東西
然後sequential就要用
箭頭的等號
combinational就要用
普通的等號
這樣
反正呢
就是這個表
最後可以給大家對照用
好
那parameter的部分呢
它其實就是
你平常宣告constant的東西
就是你要幫一個數字取名字
這樣你比較好
比較好去變
比較好去讓程式可讀性比較高
這樣
那就是我們的example裡面也有
你要你如果說
你要講bit數是8個bit
那你這個width就是7
那你這個宣告的時候
那這個width其實就是7到0
那就是8個bit這樣子
類似這種啊
就是一些小使用
你不不想用它也可以這樣
讓你的code更
可讀性更高
然後更flexible這樣
那再來呢
就是要講這個
我們剛剛講說
有combinational跟sequential的電路
這樣
那這兩個東西呢
是我們verilog裡面
最主要要寫的
就是function的部分
前面都是講一些基礎的東西
那一些function的操作呢
就要看combinational跟sequential block
那combinational呢
有分兩個
兩個寫法
一個是continuous assignment
一個是procedural assignment
這個東西呢
你往回翻兩頁呢
就看到我們剛剛
兩頁嗎還是一頁
就是我剛剛右下角整體的那個表格
continuous assignment呢
就是assign這個東西
就是assign
你在寫的時候呢
就是我要寫一個function的話呢
我就是要寫assign
然後一個值
等於一個運算
這樣子
這是continuous assignment
那
continuous assignment呢
它在這個
等號的左邊呢
就要用wire
這我們剛剛其實有講過
就是因為你用assign吧
assign的時候呢
你左
可以改的值就只有wire
所以這個signal a
一定要是wire
這樣子
然後右邊就隨便
RHS right hand side就隨便
然後bitness
這東西就是
等號左邊跟右邊的bit數
要
小心他們要一樣
也不能說有一個4個bit
等於一個3個bit
電腦就不知道說要幹嘛
他其實知道
他可能會在前面補0
但是
你在寫Vlog的時候呢
要盡量小心
不要這種
不要這種
有點難預期的事情這樣
好
好
好
ok
那就這邊就是這樣
那我們就是前面有講到說
continuous assignment跟procedural assignment
那continuous assignment呢
就是assign
然後呢
procedural assignment呢
應該在下一頁
對
procedural assignment呢
就是一個always blog
那他這邊就是寫說
always at sensitivity list
這東西
我等下再講
他就是
格式就是
你要寫always at
什麼東西
下面這邊就有always at
中間應該不用空格
這看起來好像有空格
但是應該不用
還是只是視覺上的問題
我也不曉得
反正應該沒有
就是像下面這樣
就沒有空格連起來這樣
然後
裡面就寫signal a
然後等於function
對
我剛前面都沒有講
後面要加分號
大家記得要加分號
對
就是除了這種always
什麼的宣告以外
後面很多都要加分號
反正回去看那個
前面的例子
就知道說哪一下加分號這樣
然後我們說always blog裡面
左手邊的訊號
都一定要是register
這前面的表格
其實也有放給大家看
所以呢
always這個東西
左邊的訊號
就一定要是register type
然後右邊也是
隨意
都有可能這樣
然後
就是如果你always blog裡面
超過兩行的話
那你前面跟後面
就要有一個begin跟一個end
這樣
可以看下面這個例子
就是一個always
at什麼東西
然後begin
end
然後裡面寫兩行的運算
這樣
然後呢
我們剛剛講說
我們要講sensitivity list
這什麼東西呢
就是啊
sensitivity list的意思是說
當
這個sensitivity list
裡面的事情
裡面的訊號
他們發生改變的時候
我們就執行
always blog裡面的東西
我們說整個電路啊
整個verilog
他的全部的電路
都是在同時運行
那同時運行的話
我要怎麼知道說
我不能說
叫他隨時一直
一直在
一直在
一直在計算
這樣很奇怪
那
其實呢就是說
如果這一些訊號
他有變動的時候呢
那我們就進來這裡面
去操作這樣
所以呢
有點像通電之後
所有always blog
都會開始判斷
這樣子
那我們前面的assign的話
他就是
不管怎麼樣都會開始運作
就對了
對
那一般來講呢
除非你用很特別的電路
不然的話
我們不會這樣寫
我們會寫一個明字號
就是只要
就是讓電路自動判斷
那基本上呢
就是他會
他其實是會把
把裡面如果有
if else的條件的話
條件發生變化
那我的運算也要
運算結果應該也會改變
那他就會幫你
加到這裡面
然後等到右邊的值改變了
那我左邊的出來的結果
應該也會改變
那他就也會進來這裡
去做一次運算這樣
所以呢
我們通常是用一個明字號
大家就
以初學者來說
就寫這個就好
其實我這輩子也沒有寫過
左邊這個
我寫了很久很久的always blog
也沒有寫過這個東西
也沒有寫過左邊這個東西
我都是寫明字號這個
所以大家其實就寫這個就好了
好
那所以呢
這是always blog的一種用法
是明字號
他是combinational的
procedural assignment
那我們剛剛說有combinational
跟sequential的電路
sequential呢
也是用always blog
可是他這個地方不是明字號
我們等一下也會講
但是就是我會交叉的
一直提醒大家這樣
那也可以回去看前面那個表格
就是我列了一個小小的表
在右下角那個
那個東西我有寫說
combinational有分always跟assign
兩種做法
那sequential就是只有always這樣
所以呢
recap一下啦
這邊是combinational
那always明字號
那這邊的這個算式呢
就都是用等號
然後後面有分號這樣
大家可以看到宣告的時候要分號啊
然後always跟begin end不用
那普通的算式也是要分號這樣
好
然後combinational呢
呃這邊呢
我們就要講if else跟case
case呢
就是就是
跟if else有點像啊
反正就是
如果這個1n這個數值
他是等於0的話就執行這個
如果是1的話就執行這個
然後有一個default value這樣子
就是說1n如果
其實啊我就會想到這邊寫一個
呃
譬如說一個bit-b0
一個bit-b1這樣子
那不過
你看這樣我就不知道這個1n是幾個bit嗎
這就是沒有那麼漂亮的coding style
沒有那麼嚴謹啊
這樣
啊題外話
假設這個1n呢
他是三個bit好了
那這邊就寫兩個case
那你說那剩下的case怎麼辦呢
你就要寫一個default
那剩下的case呢
就會assign給
assign到這個default的case裡面
這樣子
那這裡呢
如果1n是一個bit的話呢
是default就可以不用寫
可以
但是
強烈建議大家還是寫
就是
不管怎麼樣就寫一個default
免得有一天
你覺得1n要多一個case
然後加了一個bit
然後多寫一個
可是default沒有補
那電路就會出
一個東西叫做ledge
那ledge呢
我不知道你們上課教了沒
但是我這邊不會特別講
簡單說呢
ledge呢
不能算是錯的
但是
我們這門課不允許
對
一樣啊
我寫那麼久的vlog
我沒有使用過ledge
因為ledge的東西
ledge有點像是
另外一種的preflop
我們前面有講preflop嘛
那
幾乎全部都可以用preflop去實現
只是ledge可能有一些優點
有一點點的優點
但他比較難控制
所以
我們這門課規定不能有ledge
那什麼情況會有ledge呢
就是這個incomplete case
就是說
你沒有把情況
所有可能發生的情況
你要寫清楚
像是你如果有寫if
但是沒有寫else的話
那
他電路就
電腦就不知道說
其他的case
要做什麼事情
對不對
只知道if這個case要幹嘛
可是else他就不知道
那一般呢
你在寫C++那種東西啊
他就是else那就不做嘛
不行
你真的不做就是要把他寫出來
要寫自己等於自己
之類的東西
其實也不應該等於自己啦
應該是
大家可以看那個
範例裡面的preflop的東西
他會等於
等於preflop的input
input等於preflop的output
把output接回來這樣子
那
我這邊有打一個星星
因為這個非常重要
就是說
大部分
大部分大家寫vlog的時候啊
常常會寄信給我問的東西
這是其中一個
就是你發現code有bug
為什麼
不知道
就是這個東西可能沒有做好
也許會出現
造成初學者一些
你沒有預期到的
一些事情發生
那就會
有點難控制啊這樣
所以我們這邊說
所有可能的case
都要補齊
都要寫清楚
然後而且你要use default
就是case的時候你就要用default
那if的時候就要用else
那語法在這邊
就是if那有else
if然後最後有else
那如果你有很多行的話呢
也是一樣
這邊就要begin跟end
每一個if裡面就要begin跟end
裡面有很多個statement這樣
那case也是一樣
我這個case呢
這個target這個
這個變數呢
他有什麼condition1
condition2
那一樣
我這裡面如果有多個的話
也是begin end
然後寫兩行的指令這樣
最後最後一定要有一個default
那要把這個
statement也把他補上去
那
我們剛前面有說啊
vlog code寫起來
會看起來很對稱
就是因為這個原因
有點像是說
我們這邊enable這個東西啊
他有兩個訊號
會受這個東西控制對不對
output1跟output2
那
如果我這邊寫output1
然後output2寫了之後呢
第二個這邊寫output1
output2沒寫
這邊也寫output1
output2沒寫
那
你其實就可以想像說
電路知道output1要怎麼做
但是他不知道output2要幹嘛
所以也會
output2就會變lag
output1就會是普通的free slot
所以要把所有所有的case
裡面的所有變數
全部都要寫
寫負7
所以他就會是
一樣長度一樣長度一樣長度
這樣子
所以他就會變得非常非常的
很有結構性
他看起來就是
一塊一塊一塊
每一塊都一樣大
這樣子
這就是verilog電路的一個特色
所以這個if啊
else if else
這裡也是
你就是所有
左邊有出現的東西
下面這邊就要再出現一次
這樣
這個東西非常重要
這樣才不會有lag
有lag的話呢
後面有tool會
跑過之後
tool就會告訴你
你哪一些東西有lag
那作業有一些地方
要叫你在這個tool上面截圖
截圖確認
每一個變數都是free slot
沒有lag才可以
這樣
lag發生就是這個情況
然後
對但是
大家還是要小心就是說
你還沒有用到那個tool之前
初學者可能不知道
自己寫出了lag
那你的code
跑出來跟你預期不一樣
他有bug
你就不知道說
是因為lag造成的
所以這個要很小心
就是
除非你要跑後面的步驟
去確認你的code有沒有lag
不然有點難察覺
這樣
這是case的補齊
非常重要
好的
那這是寫什麼東西
在這
哦
這個就是我們剛用assign的東西
assign啊
你不能用if else
這是很奇怪的規定
但是
因為assign通常就只有一行
所以呢
你要if else的話呢
就是
某一個condition
然後打一個問號
就是
就是if else的意思
那if true的話
那我後面就做什麼操作
然後false的話
就做什麼操作
那就是
這個condition如果是true的話
就會把這個東西
assign給a
如果這個condition
是false的話
就會把後面這個東西
assign給a
這樣子
所以呢
你就不能寫
這個東西
就是if enable 1
等於1的時候
這樣
else這樣
不行
這個東西其實就跟
上面的這個
output 1的功能
是一樣的
所以大家可以去
去
對照一下
可是這個是錯的就對了
反正就是assign的時候
只能用這個
括號問號冒號分號
這種寫法
好
那到這邊呢
是
這個
combinational的這個
部分
然後
就是
這個地方他就不用
補齊什麼case
因為他
所有case都在這裡面
他就
他就都有了
所以就
就沒有特別怎麼樣
對
那
再來呢
是sequential的部分
我們剛剛說
combinational part
跟sequential part
所以呢
sequential part講完之後呢
我們
第一堂課就差不多
可以休息了
所以大家再撐一下
我覺得講這個還挺無聊的
我不知道大家
有多少人還醒著
不過
這邊是
我們盡快把他講完
sequential的部分呢
也有一些特別的東西
需要去記得
那
我們前面也有整理
那個表格
可以再回去看
反正呢
我現在講了很多東西
我都把它整理到這邊
讓大家比較方便
那
sequential呢
他就只會用always block
但是呢
他always block
後面的小括號呢
他就不是什麼
sensitivity list
也不是什麼名字號
他是
sensitivity age
然後clock
然後
有可能會
再加
reset
所以呢
看例子會比較快
下面這邊的例子呢
你就可以看到說
他有
有可能有
clock跟reset
或者是只有clock
clock跟reset
或者是只有clock
那
我們剛剛舉例的時候啊
有說什麼
past age
negative age
就是電路的
那個clock的正圓跟負圓
正圓
past age就是上去
負圓
negative age就是下來這樣
就是
字面上意思來
就是
每次
當at
你的clock
在past age
在上去的時候
那就執行下面這些事情
或者是
你的reset
上去的時候
那也執行下面這些事情
就兩個條件
都有這樣子
那或者是你只看clock
這樣
那大部分呢
電路都會有一個reset
所以
大部分我們都是用
左邊這一種
那右邊這一種
spec也會有
但是
比較少
對
那這裡面其實也有reset
就是說
如果
如果進來了之後呢
我們可能想要判斷說
他到底是因為reset而進來
還是因為clock而進來
所以呢
上面這邊就是
如果是reset的情況下
那就執行這一些
如果不是reset
那就是每一個clock cycle
都執行下面這邊
那
這邊呢
我會稍微把他講細一點點
因為老師剛剛說
大家沒有
沒有學過這個
應該說對這個東西
還沒有到很熟這樣
我們可以看到說
我們這邊啊
這邊的變數
我們可以看這兩行
這兩行呢
這邊變數都是
某一個變數
然後
next
什麼變數
count
next count
state
next state
那是什麼意思呢
這個其實就是我們剛剛說
這個sequential part
他就是在寫
sequential part
就是在寫這個
freeflop的
行為
一個freeflop呢
典型的freeflop
他就是在這個樣子
他會接reset
他會接clock
然後input就是D
他是next state
然後output是state
那是什麼意思呢
我們剛剛說
input
他會被擋下一個clock cycle
然後再
送給output
所以呢
就有點像是說
我現在有一個變數是state
這個freeflop就叫做state
但是
他的值
會在下一個clock cycle
變化的時候
才會改變
他的value
會在clock cycle
變化的時候才改變
那改變成什麼呢
就是你下一個時間點
的state
是這個值
所以
這個next
或者是我們有時候
只用n底線
他就是下一個時間點
要變成這個
所以大部分呢
我們都是用clock
來控制next state
去
變成這個
變成這個
改變這個
variable
他的值
這樣
所以呢
在這個sequential part裡面呢
下面這個地方啊
幾乎全部都會長這個樣子
你有20個變數
下面就是20排
然後全部都是變數
箭頭
next變數
這樣子
就像是
有點像是把next
什麼東西
推給
前面這個變數
所以他是用一個箭頭
那什麼時候用箭頭
什麼時候要等號呢
其實只有這邊要用箭頭
那
我等一下還會再講
然後前面那個整理的那個表
也有寫
什麼時候用箭頭
什麼時候用等號
那
這邊呢
就是一個想法是說
因為這邊有被擋下來一下
所以你要把它推過去
所以用箭頭的
把這個值
推過去
推到這個
推到這個這個
freeform的後面的output
這樣子
好的
那
如果reset的話
那就是發生下面這些事情
reset就幾乎
這邊也一樣要補齊
一樣這個這個
你走上面有兩個
下面就要有兩個
上面有20個
下面就要有20個
那
也一樣是箭頭
但是reset
reset就是常常就是
電路一開始嘛
所以常常就是
全部都是給0
所以呢
他下面就是一整排都是0
除非有一些不是
有一些特別的
這個ID
我們前面說用variable
可以去控
去
用parameter
可以去
去寫出來那種
就是
代換的名稱
他搞不好也是0
這樣
然後
剛剛有人叫我嗎
還是我
聽錯了
好
沒有
好
那
這裡呢
要講一個東西是
asynchronous reset
跟synchronous reset
那這是
非同步的reset
跟同步的reset的意思
那非同步
reset的話呢
這個電路啊
整體就會叫做
非同步電路
然後
這個的話呢
就會變成
整個電路都叫做
同步電路
好
所以呢
這東西啊
我以前考試有遇過啊
但是我不知道
是不是被考
所以呢
我打一個綠色的星星
綠色就是
綠色就是我個人的看法
大家如果
如果沒有考的話
請大家原諒我
原諒我
這樣
原諒的顏色
好
然後
有什麼好笑嗎
奇怪
好
對
所以呢就是
我曾經有遇過考試
考這個啊
所以
先聲明喔
我跟老師的考試
完全沒有關聯
就是老師會自己出題目
自己改考卷
自己
就是完全不會給我看
所以
跟我一點關係都沒有
就是
這東西啊
你在寫
Verilog的時候
其實不太會用到這東西
但是
考試可能會考這樣
就是說
非同步是這樣子
就是
嗯
嗯
我們先看同步好了
因為同步
同步比較特別
比較少情況是用同步
大部分都是用非同步
那
所謂的同步
同步的Reset
Synchronous Reset
是這樣
就是說
這邊有可以看到Clock
然後有
這個Reset的訊號
然後有State
就是某一個
某一個Variable
這樣
那
他要這兩個
同時發生
也就是說
他譬如說
他是要Clock的Passage
啊
這邊就是往上的箭頭
Clock Passage的時候呢
同時我的Reset
也要是等於1
的情況
我的State才會切換
這個
這種訊號啊
這邊打一個
這個
這個有點像叉叉的東西
他就是訊號轉換
變換的時間點
這樣子
所以呢
你看他就是要
Reset at the Passage of the Clock Signal
他就一定要在
Clock Signal變化的時候
兩件同時成立
才可以
才可以Reset
那如果
其中有一件沒有成立
譬如說你這邊Reset
只是Reset很短
然後沒有碰到這個Passage
怎麼辦呢
你的State就沒有Reset
對
那一般來說
我們的這個電路啊
我們都希望他要
不要
不要說我Reset按下去
他沒有Reset
這很奇怪啊
對不對
我不小心按太快而已
我只是手
手按的不小心按太快而已
他這樣就沒有Reset到的話
那我很虧啊
就
就有點像
電路不受你控制
那種感覺
所以比較少會用下面這個啦
對
因為這個東西叫同步的Reset
那上面就是非同步的Reset
就是說啊我Reset
不管在什麼地方按啊
他都
只要我Reset一按下去
他就開始變化
他就開始
他就開始被Reset這樣子
不用一定要碰
碰到這個Passage
就在前面這邊就碰
就變化了
那下面這邊他就是
要在Passage的時候
Reset按下去
要持續到這個地方
等到Passage之後
他兩個
兩個條件都符合了
他才會變化這樣
OK
所以這個就是
同步跟非同步電路
好
那
再來呢
我們剛剛在講這個
等號跟箭頭啊
等號跟箭頭呢
他都是
都是等於的意思
我也不知道為什麼要這樣規定
但是呢
呃
就是
有一些情況要用等號
有一些要用箭頭
那箭頭呢
叫做Non-Blocking Assignment
然後等號叫做
Blocking Assignment
啊
寫錯了會怎麼樣呢
他其實
有一定邏輯在
但是我這邊
講下去
我怕會讓大家
混淆
所以呢
如果你真的很想知道
你可以上網去查
但是
呃
一個一個原則啦
就是說
Non-Blocking Assignment呢
只有在
Sequential Circuit
也就是
操作Flip Flop
那些東西的時候
會使用
那Blocking Assignment呢
就是在
Combinational Circuit
也就是我們前面有說
Always
擬字號
然後或者是
Assign
什麼什麼
變數等於
什麼東西的時候
才會用到
這東西呢
我們前面那個表格
再回去前面
又再看到
右下角那個表格呢
我有寫這個東西
Register
就會用
箭頭
什麼東西
或者是Register
等於什麼東西
或者是Wire
等於什麼東西
那個那個表格
都把它寫在這裡面了
那
我沒有寫Non-Blocking
跟Blocking
因為我其實自己
也常常記不住
我記得
記得方法就是
因為這個比較長
所以他是Non-Blocking
因為這個字比較短
所以這個字就比較短這樣
當然並不是這個意思
就是
他的這個Blocking
跟Non-Blocking
其實他就是
有沒有擋的意思
那
那
這個這個
可是他
我們這邊講有沒有擋的話
就會造成大家
混淆
就是跟我們前面講的東西
有一點不一樣
所以
大家不要管他
反正就是
該用箭頭的時候
用箭頭
該用等號的時候
用等號
什麼時候用
前面的
不知道十幾頁的投影片
應該有
去看那個
Always Block
如果是米字號
就用Blocking
就是普通的等號
Always Block
如果裡面有Clock
Always Block
如果裡面有Clock的話
那就用箭頭
還記得通通要有Begin&End
Always
這邊就有Begin
然後有一個End
那If
就有Begin&End
然後又有Else
然後有Begin&End
然後有一個Reset在這邊
這些東西就是
複習一遍
這樣
好的
那最後就是
最後一頁投影片了
那
時間還蠻差不多的
不好意思
我們下一節課還有
只是會休息一下而已
就是說
這次在講說
如果你等號跟箭頭
寫錯了的話
你可以看到
左邊這邊
他是一個
Passage有Clock
Always有Clock
可是我裡面
只用等號而已
不是應該用箭頭嗎
那出來
結果就會變成這樣子
你可以看到說
我是Temp等於D
Q等於Temp
那
可以看到說
右邊才是正確的用法
他是用箭頭
就只是插一個箭頭
跟等號而已
他合出來
他合出來的電路
就會變成
這兩個不一樣了
如果我中間
要有一個Temp
他Temp怎麼不見了
因為他就把他接起來
然後就先操作這個
再操作這個
然後就就全部都
全部都把你省略掉了
所以呢
就會變成這個樣子
那
很少
很少很少
我也是沒寫過
這種東西啊
就是你想要用
這個東西寫在這個裡面
因為你有其他的寫法
可以去取代
這種狀況就對了
你想要做到這個
那我幹嘛要寫Temp
我就寫
寫Q等於D就好了
我幹嘛要寫這個Temp
所以
這東西
是用不到的
那
我強烈建議初學者
不要這麼做
對
我
我從來沒有看過
有人這麼做啦
反正就是
要用對地方
我只是要說
這樣其實並不是錯的
但是
我從來沒有看到
有人這樣用
就是他的
有點像Verilog
這個東西太少人寫了
所以他的
語法
印的有一點
隨便那種感覺
反正大家就是要注意說
要用右邊這個情況
這樣
那我們第一堂課
可能就先到這邊
那大家有問題
可以來前面問我
然後我們休息一個
十分鐘好了
然後再來講
所以現在是兩點十七
那我們就兩點二十七的時候回來
