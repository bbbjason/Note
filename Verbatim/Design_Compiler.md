好,我們就要上今天的助教課,不知道大家作業寫得怎麼樣?
今天我們要上的是Verilog後段軟體的一些操作教學。
上個禮拜我們應該有稍微講過要怎麼寫Verilog,一些語法相關的東西,還有寫的時候要注意的事情。
那我就想到說,如果寫Verilog的時候有一些東西沒有注意好的話,那在做後段處理的時候,有可能後段就會出現一些問題。
那後段要做什麼呢?就是今天要講的部分。
那今天要講的部分呢,這個就是Synthesis的Tool,然後後面還會有Layout的Tool。
反正就是我們說我們的RTL,就是Verilog的Code,那經過Synthesis合成之後呢,就會得到GateLevel的Code,GateLevel的檔案。
然後最後再經過Layout的這個APR的Tool,那得到這個APR之後的結果。
所以我們就是會講後面這兩個Tool這樣。
那大家下一個作業,現在是作業二,作業三應該就是要把這兩個Tool跑完這樣子。
OK,好,那這邊就是我們剛剛講的。
RTL的Code呢,再經過Design Vision,或者是它有另外一個名字叫Design Compiler,這樣。
這個過程我們就叫做合成,合成之後呢,就會得到這個GateLevel的Code。
那最後呢,再經過這個Transistor Level,那就是再經過這個APR的Tool,然後得到Transistor Level這樣。
好,那麼一樣齁,我們一開始還是要就是Source一些環境的東西,就是Source這個東西,231工作站要去Source這個。
然後再來你就可以開我們剛剛說Design Vision或Design Compiler,因為它有兩個名字,就是因為這個Design Vision就是DB,然後這個是有圖形化介面的。
那另外一個名字Design Compiler就是要打DC Shell,那這個東西呢,它就是沒有圖形化介面的。
所以呢,如果你是比較一開始初階的話,我們會建議你用DB,然後後面打一個AND這樣,那就會有視窗跑出來,那比較可以邊操作邊熟悉整個環境在做什麼這樣子。
好,那在開啟之前呢,它有點像是開啟這個程式的時候啊,你在現在這個資料夾,就是你現在在的這個資料夾呢,要有一個檔案是點開頭的,然後就是DC Setup這個檔案。
那開啟的時候呢,開啟程式的時候呢,它會去找在你現在的資料夾找這個檔案,那把裡面的一些設定的東西啊,路徑的東西讀取進來的時候再打開這樣。
所以這個檔案應該是要先準備好放在那邊的。
所以大家要注意就是這個檔案有沒有在這樣,有沒有在你目前這個資料夾,一定要在這個資料夾裡面去開Design Vision這樣。
好,那對,這就是說這個可以去看一下這個檔案裡面啊,那裡面就是有一些Sale Library啊,還有一些像這個這個其他的一些包含一些什麼速度啊,一些什麼線啊的一些Library的Model,通通在這裡面這樣。
把它的路徑都在這裡面,大家有興趣可以去把它打開來看看這樣。
比如說我們剛剛講的,它是有點開頭的,所以是一個隱藏檔這樣。
好,那再來就是Design Vision的一些按照步驟的操作,也是一步一步操作啊。
那這東西的話就是大家一開始可以照著按啊,照著操作這樣,那慢慢的多做幾次之後會去細想說它裡面一步一步到底都在做什麼這樣。
Design Vision的話,它的這些步驟啊,做起來比較,應該說這邊做起來比較不會那麼有問題,我們待會後面一堂課會講另外一個Tool,做起來比較容易出一些Bug喔。
那所以Design Vision的話,通常這個Flow比較說,我們還可以分析說裡面會出了一些什麼錯誤。
但是在後面我們說ATR的Tool的時候呢,它其實有時候出錯了,你繼續問我,我可能也會說我也不知道。
就是有問題的話,通常我們就是會從頭重新做一次這樣子。
從那一開始重新做的,我等下講到另外一個Tool的時候會講。
那這邊想講的就是說,Design Vision如果中間有出錯的話,或許我們是可以去分析一些原因,然後去修正你的Design這樣子。
那大致流程就是這樣啊,就是你要把Design讀進來,它設定一些Constraint,就是你這個Design的一些Constraint,然後讓軟體去Check你的Design,然後它去Compile。
Compile完之後呢,就把一些Report吐出來,Report吐出來是給助教看的,然後再來就是把一些存檔啊,存檔你要另外存一些不同的不同型態的檔案這樣子。
首先就是讀檔,你打開Design Vision之後呢,就會長這個樣子,然後就是File,Read,然後選擇你的這個.v檔。
那當時做這個投影片的時候是Auto-Seller,自動販賣機,就是看你的這個.v檔,這次作業我也忘記.v檔的名字是什麼,反正就是選那個.v檔,然後Open。
Open之後呢,它就會有一個地方,它會顯示Log,它就會跳出一大堆Log。
大家注意說這個表格,它很明顯就是它會跳出來啊,那如果這邊裡面有的時候會跑出Latch,就是我們上一堂課說,上禮拜啊,上禮拜說這個,這裡面全部都要是Free Frog,我們這堂課目前是不允許大家使用Latch的這樣子。
就是你要把所有Case補齊,把所有這個變數可能會發生的事情都寫清楚,那這邊就會沒有Latch這樣,把它全部都是Free Frog。
然後下面會有一個讀檔,這個Complete Successfully這樣。
那如果說沒有這個訊息,就是這邊有可能是全部都是Free Frog,但是中間有一些其他的錯誤訊息,那你讀起來就沒有成功的話,那你就要去看那些錯誤訊息。
那如果有要問問題,如果要寄信問我問題的話,錯誤訊息要附給我。
有些同學會寄信,以前不是你們,就是以前就有人寄信問我說,我這個讀檔失敗了,為什麼?就接了一個,不知道Incomplete還是什麼,給我。
對,可能錯誤訊息沒有給我,基本上我是沒有辦法通靈的。
然後讀完了之後,反正這個就是必須要有這兩個都有達成,那接下來就是要設定一些Constraint。
這個Constraint呢,這個東西我們作業好像沒有提供給大家,我們先不用理它。
先不用理它,反正呢,我們應該會有一些這個Design的Constraint,那如果我沒搞錯的話,我們作業裡面應該是給一個.sdc檔,.sdc檔的這個檔案,對,那你就是去讀它。
你可以在這邊打source什麼什麼什麼,.sdc,然後它裡面就是寫一些Constraint,大家可以把它點開來看看,這樣子。
好,那打開了之後呢,它就是長這個樣子,長這個樣子呢,你就可以看到說上面有設定說一個Clock Cycle是多少,那這個Clock Cycle的單位是Nano Second,就是Nano Second。
那下面還有一些就是,之後大家稍微熟悉整個Flow之後呢,其實下面這些東西代表什麼意義,都要一個一個自己去查,然後大概知道它在幹嘛這樣子。
好,Create Clock,Set Don't Touch Network,Set This Hold,把這個Hold Time Validation修掉,然後什麼Clock Uncertainty啊,不知道老師上課有沒有講到,反正就是Clock的一些不確定性,還有多少Nano Second,都把它設一設。
好,然後比較重要的是什麼Input Delay啊,最小的Input Delay,最大的Input Delay,然後還有Output Delay這些東西。
那這些東西呢,我們這邊可能不會講到這麼細啦,因為要講的話,還要講一些Paper Knowledge,蠻花時間的,所以這些東西我現在是不會細講的。
但是啊,我在這邊特別講說,修完這堂課以後,你在做其他Design的時候,有可能你是要去設定這些東西的,但是我們的作業呢,是除了紅色這個以外,下面這些都是不能改動的。
所以目前我不會講的原因也是這樣,就是說,你只要去確定說你的Design要跑多快,這樣,你一個Cycle,要多少Nano Second才可以把事情做完,這樣子。
那剩下的這些呢,就是都不能改,這樣。
那就像我們上個禮拜講的啊,你的Verilog呢,多少Nano Second可以跑完,基本上是Verilog是一定都可以跑的完,設3啊,設1000啊,都可以,設0.5大概也跑得完吧,我不知道,我沒設過小數點。
反正就是Verilog它的執行,我們說它是在一瞬間就全部都跑完,這樣。
那實際上呢,電路在充放電啊,需要一些時間啊,然後中間會有一些什麼可能是Delay啊之類的,這些東西在Verilog的層面都沒有考慮到。
那到了這個,我們現在在跑的這個Design Vision呢,跑完了之後,會產生Gate Level的Code,Gate Level的這個Netlist。
那Gate Level的東西呢,它就有考慮這個時間的資訊,所以你就可能說,你有可能說Verilog跑起來都很正常的可以跑完,但是在這個Design Compiler跑完之後呢,這個Gate Level的部分啊,就沒有辦法,就它可能會出現一些Timing Violations之類的事情。
所以呢,這個東西可能就需要去放寬條件之類的,而10秒不會過,你就放20秒之類的。
好,那把剛剛那個Constraint讀完的時候,雖然剛剛我們前兩頁投影片說它是寫TCL檔,但是其實有的時候我們會寫SDC檔啊,就是這個Sender Delay Constraint File這樣子。
反正就是跟時間相關的檔案,跟時間設定相關的檔案是SDC檔,就是上頁頭影片那個東西這樣。
然後再來呢,讀完那個檔案之後,你就Source它,Source那個什麼什麼點SDC,Source完之後呢,就可以去Check跟Compile你的Design。
就是這邊按它Design,Check Design,然後按OK,然後Design,Compile Design,然後按OK。
反正這裡面其實有一些可以設定啦,如果你希望說它的面積特別小還是什麼,它的Power特別小,你這邊的這個Effort,就是它花多少力氣在這個Customize這個Design上面的話,你就可以去選這些東西。
基本上,科技先用Default就好了,Default它都是Medium,按OK。
那Compile呢,通常會花一些些時間,要看Design的大小。
基本上以我們的作業來說的話,我猜應該是幾秒鐘就結束了。
但是如果是一些,譬如說,像我們今天是數位的這個數位IC的實驗室嘛,那大家碩士論文就會,也會做這種東西。
大家碩士論文的東西呢,Compile起來可能就要數個小時之類的,甚至半天一天之類的。
都有可能,看電腦的效能跟這個看你的Design寫得好不好,還有看你的Design有多大這樣子。
好的,那就是Compile完之後呢,就要寫一些報告,就是寫一些這個Report,那給助教看嘛。
那要看幾件事情啊,第一個是這個Area,面積。
面積的話就是Design然後Report Area,然後你可以寫選你的檔名啦,檔名你可以隨便打,然後到時候看腳腳格式,再去改檔名就好了。
按OK,就會產生這個報告,右邊這個報告。
那這裡面呢,有分Computational Area,Non-Computational Area,跟Net Interconnect Area這些東西。
那基本上呢,上面這兩個啊,第三個我們通常不會去看。
因為現在的Webinar Model呢,它並不是那麼的準這樣子,就是在這個階段,我們說還有下一個階段嘛。
在這個階段呢,這個線啊,這些連線的東西,它還沒有做得很真實,對,它只是稍微估算一下而已。
所以這個東西呢,我們不會去看,我們只會看上面這兩個,就是右邊紅窗窗起來這個地方。
那這兩個加起來呢,把這兩個數值加起來就是下面這個,Total Sale Area這樣子。
所以第三個這個我們就不看,Total Area也不太會看,對,我們比較少去看這個東西啦,我們通常都看Sale Area這樣。
所以Report裡面呢,我們可能也會問面積跟評分標準之類的,我們通過應該有一個評分標準是什麼,AT值,面積乘以時間。
那看的Area通常就是看這個Sale Area的部分,Sale Area就是上面這兩個加起來這樣子。
好,那這個是Area Report的部分。
那再來呢,要Report這個Timing Report的部分,那就是按照這邊按啦,反正Report,然後Report Timing,上面沒有,Report不見了,Report Timing。
Report Timing之後呢,也是選了一下檔名,照這邊選,然後按OK,那寫出來的Report就會長這個樣子。
基本上呢,右邊這個東西啊,其實你在Compile之後,反正就是Report Timing之後呢,就是你Compile之後啊,它就會,我們說它會把一些時間的delay的資訊都加進去這樣子。
那這裡面呢,就可以,大家其實可以不用看上面這些啦,我等一下會教大家上面這邊大概是什麼意思。
不過呢,就是你設定,譬如說我們剛剛設定10ns,那這個Data Required Time呢,就會是這個10ns,會多一點點什麼0.75那個雜七雜八的東西啦,不要理它。
這個大家有空可以再自己去細看啦,反正就是大概是那個10ns這樣子。
然後呢,這個電路啊,它在合成的時候呢,它會幫你合成嘛,它會幫你Compile,然後合完,就是我們在這個階段要合成啦,就是Synthesis,Design Vision做的事情要合成這樣。
它幫你合成呢,合出來的電路,它就告訴你說,這個電路需要跑這個4.8秒7,那跑完之後,你還剩下這麼多,你的Design還剩下這麼多,叫做Slack。
但是所以呢,你的時間設計要10秒,然後跑4.8秒,剩下的5秒這樣。
所以我們說這個剩下的時間,它要是Positive,就如果你剩下的時間是負的,就它幫你合成,發現要跑20秒才可以跑完,不是秒啦,20秒才可以跑完,那這邊就會變負的。
反正如果是負20,這邊剪起來就會負10,那就不行,你的Timing Slack要是正的,或者是0,0也可以,那它這邊會寫Match,然後如果你是負的話,這邊會寫Violating,那就不行。
所以在你的Homework Report裡面也還有這個東西,應該會叫大家截圖。
那這個東西的話呢,稍微跟大家講一下實作上的事情。實作上的事情有點像是說,老師叫你畫一張電路,畫一張Homework 1有畫的Layout,老師叫你畫一張Layout,給你設定的面積是只要有畫出來就好。
那你就會隨便畫一個,畫起來可能很大,那老師如果有設定一個,譬如說要你在100的面積以內畫出來,那就有一點點困難,那你可能就會努力的把它擠到100以內,你可以畫出來是90的面積。
那如果說老師跟你說,老師今天初作業的時候說,我希望大家畫在75以內,哇,那剛剛畫了90就不行了,那你就要再努力的把它擠得更小,然後你發現怎麼樣我都擠不下去,不知道老師是不是少加了什麼Tempo之類的,那你上傳作業的時候只好上傳一個面積80的,雖然沒有到75,但是也沒辦法,已經努力擠過了。
所以一家音訊也在做類似的事情,就是說,如果老師設面積是500,那我就隨便做,老師設的要求是10ns,那我隨便做一做,我4.8ns跑完了,OK吧,符合要求。
那當然,老師就表示剩下大概6ns的時間是多的,其實是你的餘裕的部分,有點像是老師的Content可以設4ns之類的,你可能也做得出來。
那所以呢,這東西你剪回去之後,譬如說你原本定10ns的時間,剪回去之後剩下4.05ns,表示你團隊設4.05ns,它其實也可以做出來。
那甚至呢,我剛剛舉的那個例子呢,其實是說,你的這個條件如果放得鬆的話,那這個Design Vision它就會隨便做,那如果你條件把它設得嚴苛一點的話,它就會認真一點做。
那你把它設得非常非常非常嚴苛,它又做不出來,那就會Violating了。
所以呢,以這個case來說,它雖然做出來是4.8,可是我們這個剪回去之後,可能4.05ns就可以跑過了,但是實際上你可能設3ns,它也可以合得出來,設2ns搞不好它也可以努力一點,搞不好也可以做得出來。
所以呢,如果看到這個東西啊,通常只要是有數字的,我們就會把這邊減小,就是如果10的話,那這個這個,就是如果這邊不是0的話,0的話就表示它已經有一點點努力了,然後就是符合你的要求,OK,那就把它吐給你這樣,把檔案給你這樣。
那,所以呢,一般我們至少會把它做到slack的edit這樣,對,這就是如果你要壓面積壓時間的時候,可能會需要去做的事情,就是你要重複,你要改你的design,改你的variable檔案,然後去多做幾次合成。
好,那report寫完之後呢,這邊會有一個report power,這個也是,這個我就比較少去看它,反正就是貼出來給助教看這樣子,我會大概看一下power裡面的東西啊,然後如果有什麼特別的話,如果有需要的話,我會再跟大家講。
不過report power通常我們沒有什麼要看的啊,對,就把它report出來,然後附在這個作業裡面就可以了。
那比較重要的是這個,這個就是getable.netlist,就我們剛剛說原本是一個variable檔,然後你經過合成之後呢,會產生getable檔案,那所以你要怎麼產生呢?
你要怎麼產生呢?你合成完之後就把它存出來,不然你就白做,白做公文嘛,對,所以這邊你要選file,然後save as,指定存新檔,然後這邊你就要選variable檔案,然後打你的檔名。
那通常我們就是原本的.b檔,那後面會加一個底線,底線syn,然後再.b,就是synthesis之後的結果。
那所以,然後把它存檔,存檔之後呢,這個東西就是你的getable的code,那我們說它裡面就會是一些gate,gate的這個,它也是variable的語法,但是它裡面就會是一些gate的module。
所以呢,合成之後你其實可以把它點開來看,是人也看得懂的code,human readable code這樣子,對。
好,那另外呢,你要存那個dtc檔,dtc檔有點像是,你存了之後你事後可以重新開啟軟體來把它打開來看看,反正就是有點像是說,記錄你現在的,現在合成的狀態之類的,合成的各種詳細的資訊這樣。
反正這個東西呢,有時候作業可能會叫大家教啦,但是有時候它有點大,所以如果setup存不上去之類的,我們塑膠可能就會叫大家說,這個不教也沒關係這樣,對。
就是要check說,就是事後如果你的code發生問題的時候,這個東西可以做一個證明之類的,所以並不是那麼的重要啦。
好,那最重要的呢,其實是這個SDF檔,就是Standard Delay Format的檔案,最重要的就是這個,跟剛剛的synthesis.v,就是gate level的檔案,這兩個要存出來。
SDF檔呢,裡面包含了真正的這個時間資訊,我們說gate level的時候啊,它就會有時間資訊,所以呢,這些時間資訊呢,其實是會存在SDF檔裡面的。
告訴你,告訴這個模擬軟體,就是,不知道大家寫作業沒有,有那個NC Verilog嘛,那NC Verilog就需要去知道說時間資訊是怎麼樣,那它才可以模擬你的電路跑起來,實際上要花多少時間,這個充放電才能完成之類的。
所以呢,這個SDF檔要把它存出來,那SDF檔呢,你就要用打指令的方式,一樣就是Design Vision最下面這邊會有一個指令的視窗,你要一些source什麼東西也是打在這裡,把它打write SDF,然後-version,然後空格2.1,然後空格,你的檔案的名稱通常會跟前面那個一樣,就是什麼什麼SYN.SDF這樣子。
那把這個檔案存出來,然後就是Scalable的這個Simulation,就是Scalable的時候你還要再跑一次NC Verilog,就要使用這個SDF檔才可以跑這個模擬。
那可以值得注意的是,上面這邊的視窗啊,我們說它是會吐一些log出來的,那可以看到說,我們剛剛前面很多步驟都是用按的,用按按鈕的,但是沒有圖形化介面的嘛,DC Share那個,就是你其實按按鈕之後呢,它下面會跑出對應的這個指令,按到指令全部統統記錄下來之後呢,其實就可以得到一個指令的一個script的檔案,
那個script檔案呢,你就可以把它存起來,那你到時候再跑那個沒有圖形化介面的那種就比較方便了,就你如果知道這些步驟它都可以好好的跑過的話,那你就可以把那個指令全部貼到這個沒有圖形化介面的這個程式裡面,然後就全部全部執行下來,你就不用在那邊什麼等這個跑完再按這個,等這個跑完再按這個,就要等很久了,你就一次把指令都丟進去就可以吃飯了。
好,那最後呢,就是要講這個GitAble的部分,GitAble的部分有這個Simulation嘛,那GitAble的Simulation呢,要做什麼呢,還有一些什麼事情要注意呢,這邊就會用一張投影片,一張半的投影片給大家稍微講一下。
好,那就是我們剛剛就產生了這個Synthesis.V跟這個SDF檔,所以呢,呃,在TestBench裡面啊,這個助教應該已經幫大家寫好了,就是說這邊呢,就會有這個SDF的這個檔案,會吃SDF的檔案這樣子,所以呢,呃,我看一下。
對,反正呢,大家去看TestBench裡面應該會有這個SDF Annotate這個指令,那通常呢,呃,我們會在Define這邊加SDF,就是看助教的看作業的那個作業的那個那個指令,他應該會告訴大家說,你NCVLog模擬的指令應該是NCVLog,然後你的TestBench的檔名,然後這個你的GitAble的檔案。
好,然後後面要加一個SaleLibrary,那後面可能還要加一個Define加SDF,或者是Define加FSDB加SDF,好,就是基本上我們上上一次其實有稍微講到啊,就是說這個如果有這個IfDefine的話,那你在指令後面就要加這個Define加FSDB,他就會執行這個,啊,如果這個SDF Annotate前面有一個Define,IfDefineSDF,那你這邊就要加Define加這個東西。
在你的指令後面,所以指令就有可能是整個連起來這樣子,好,那所以呢,就是會有這個東西啊,那這個東西就是我們說要讀這個Sender Design Format這個檔案,要用我指令這樣,啊,這個應該就是TestBench幫你寫好了,所以就是直接執行就可以了,那值得注意的是說,TestBench上面呢,最上面他也有這個Define的這個Clap Cycle這樣。
那所以呢,我們剛剛前面在合成的時候啊,有設定這個Sender Delay Constraint,就是你的這個時間的要求,就是你希望他用多少秒去合成,那你那邊設10秒,這邊就用10秒去跑,那你那邊如果設5秒,這邊就要把它改成5秒去跑,你不能說設定用什麼5秒去合成,然後這邊用10秒去跑,然後說跑過了就算過了。
助教會看你是用,就你的Report會告訴我們說你合成的時候是壓多少秒,那這邊呢,我們就會用你指定的那個Cycle的時間去跑這個模擬這樣,總之呢,就是要統一啦,就是說要跟前面Design Vision用的這個Clap Cycle的這個Time是一樣的。
那這個就是把TestBench這裡面改了之後呢,改了這個Cycle Time之後呢,那你就可以去跑這個指定,那跑完了之後呢,跑這個指定呢,後面還有這個Standard Cell的一些Cell Library,這個是tsmce3.b,或是有的時候會是tsmce3-neg.b這樣,這兩個檔案都可以啦,有一些些微的差別,不過都可以。
那這個檔案呢,去哪裡拿?我忘記作業有沒有提供給大家,但是如果沒有的話,可以去這個地方載,反正就是工作站的一個路徑啦,你就Copy它,Copy這個Path,然後Copy到點,就是加一個點就是說,複製到你現在這個位置吧,對,就是可以去把這個東西Call過來這樣,啊就是一些這個Cell Library的一些基本資料這樣。
然後啊,如果你想要看這個波形檔的話,我們上次有說,其實你這個模擬的時候,後面我們會說要加SS加R,加SS加R就是給它讀取的這個權限啦,反正就是它會模擬的比較久,但是它就會記錄波形檔的東西的Information這樣。
所以如果你要Define FSDB的話,你就要加SS加R,就是你要有讓它讀取的權限,它才可以把FSDB記錄下來,你也可以試著不要加這個指令,然後你就會發現它會跳一些錯誤訊息,就跟你說它FSDB存不了檔,存不到東西,那你就打開Enwave就看不到東西這樣子,對。
好,然後啊,最後這個東西啊,是這個,就是你在模擬的時候啊,它其實會跳很多Warning Message,它前面會是Start,W開頭,有的時候它的這個,它會有一個這個,這個有點像代號的東西,有的時候是什麼CUV,WSP,好像還有另外一個常見的,反正Warning幾乎都是不用管它的,基本上我們模擬就是不要有Timing Violation就可以,對,不要有Timing Violation。
那最後有這個Simulation的Pass,就是你這個,就是這個程式的功能都正確,這樣就可以,那Warning呢,你就可以不用理它,但是這個CUV,WSP其實還蠻常出現的,然後會很多,那有些同學就會覺得很煩,就會寄信給我,問我說要怎麼把它修掉,那基本上它是修不掉的,所以你可以在指令裡面呢,後面再加一個-no-warn,然後把這個代碼打進去,那它這個就不會顯示出來,就這樣子而已,對。
基本上可以不用理它就好啦,對。
好啦,那現在幾分內,兩點喔,嗯,對,我們第一份投影片呢,差不多講到這裡,那大家如果有問題的話,可以來前面問我,那我們稍微休息個十分鐘,好的,對,那我們就是兩點零七的時候再回來,對,好,謝謝。
